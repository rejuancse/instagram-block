!function(e){function t(a){if(n[a])return n[a].exports;var l=n[a]={i:a,l:!1,exports:{}};return e[a].call(l.exports,l,l.exports,t),l.l=!0,l.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});n(1)},function(e,t,n){"use strict";var a=n(2),l=(n.n(a),n(3)),s=(n.n(l),n(4)),__=wp.i18n.__;(0,wp.blocks.registerBlockType)("insblock/gutenberg-insblock",{title:__("Gutenberg Insblock"),icon:"shield",category:"common",edit:s.a,save:function(e){return null}})},function(e,t){},function(e,t){},function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function s(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=wp.element,i=r.Component,c=r.Fragment,m=wp.editor.InspectorControls,p=wp.components,u=p.PanelBody,f=p.RangeControl,b=p.TextControl,g=p.ToggleControl,h=p.Spinner,__=wp.i18n.__,w=function(e){function t(){var e,n,s,o;a(this,t);for(var r=arguments.length,i=Array(r),c=0;c<r;c++)i[c]=arguments[c];return n=s=l(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),s.state={loading:!0,apiResponseCode:200,apiErrorMessage:""},s.onChangeToken=function(e){s.props.setAttributes({token:e}),s.fetchPhotos(s.props.attributes.numberImages,e)},s.onChangeImages=function(e){s.props.setAttributes({numberImages:e}),s.fetchPhotos(e)},s.onChangeShowProfile=function(e){s.props.setAttributes({showProfile:e}),s.fetchBio()},o=n,l(s,o)}return s(t,e),o(t,[{key:"componentDidMount",value:function(){this.fetchPhotos(),this.fetchBio()}},{key:"fetchPhotos",value:function(e,t){var n=this,a=e||this.props.attributes.numberImages,l=t||this.props.attributes.token;return!!l&&fetch("https://api.instagram.com/v1/users/self/media/recent/?access_token="+l+"&count="+a).then(function(e){return e.json()}).then(function(e){console.log(e),e.meta&&(n.setState({apiResponseCode:e.meta.code,loading:!1}),200===e.meta.code?n.props.setAttributes({thumbs:e.data}):(n.props.setAttributes({thumbs:[]}),n.setState({apiErrorMessage:e.meta.error_message})))})}},{key:"fetchBio",value:function(){var e=this,t=this.props.attributes.token;return!!t&&fetch("https://api.instagram.com/v1/users/self/?access_token="+t).then(function(e){return e.json()}).then(function(t){t.meta&&200===t.meta.code?e.props.setAttributes({profile:t.data}):e.props.setAttributes({profile:[]})})}},{key:"render",value:function(){var e=this.props,t=e.attributes,n=t.token,a=t.numberCols,l=t.numberImages,s=t.hasEqualImages,o=t.thumbs,r=t.gridGap,i=t.showProfile,p=t.profile,w=e.className,d=e.setAttributes,k=this.state,E=k.apiResponseCode,v=k.apiErrorMessage,N=k.loading,y=void 0,_=void 0;return void 0!=p&&console.log("InsProfile",p.counts.follows),_=i&&void 0!=p?wp.element.createElement("div",{className:"insblock-instagram-profile-bio-container"},wp.element.createElement("div",{className:"insblock-instagram-profile-image"},wp.element.createElement("img",{className:"instagram-profile-image",src:p.profile_picture,alt:p.full_name})),wp.element.createElement("div",{className:"insblock-instagram-profile-bio-info"},wp.element.createElement("div",{className:"insblock-instagram-bio"},wp.element.createElement("h1",{className:"insblock-instagram-username"},p.username)),wp.element.createElement("ul",{className:"insblock-instagram-notifications"},wp.element.createElement("li",null,wp.element.createElement("span",{className:"insblock-instagram-post-count"},wp.element.createElement("span",{className:"insblock-post-number"},p.counts.media)," posts")),wp.element.createElement("li",null,wp.element.createElement("a",{className:"insblock-followers",href:"#"},wp.element.createElement("span",{className:"insblock-followers-count",title:p.counts.follows},p.counts.follows)," followers")),wp.element.createElement("li",null,wp.element.createElement("a",{className:"insblock-followers",href:"#"},wp.element.createElement("span",{className:"insblock-followers-count"},p.counts.followed_by),"following"))),wp.element.createElement("div",{className:"insblock-instagram-profile-name"},wp.element.createElement("span",{className:"profile-name"},p.full_name),wp.element.createElement("span",{className:"profile-bio"},p.bio),wp.element.createElement("span",{className:"profile-bio"},p.website)))):"",y=n&&200===E?N?wp.element.createElement("p",{className:w},wp.element.createElement(h,null),__("Loading feed")):wp.element.createElement("div",{className:"insblock-instagramfeed-wrap"},wp.element.createElement("div",{className:"insblock-instagramfeed-row"},_,o&&o.map(function(e){return wp.element.createElement("div",{className:"insblock-instagram-image insblock-col-"+a+" "+(s?"has-equal-images":""),key:e.id},wp.element.createElement("div",{className:"insblock-instagram-image-wrap"},wp.element.createElement("img",{src:e.images.standard_resolution.url}),wp.element.createElement("div",{className:"insblock-image-overlay"},wp.element.createElement("ul",null,null!=e.likes&&wp.element.createElement("li",{className:"insblock-listing"},wp.element.createElement("span",{className:"dashicons dashicons-heart"}),wp.element.createElement("span",{className:"insblock-count insblock-like-count"},e.likes.count)),null!=e.comments&&wp.element.createElement("li",{className:"insblock-listing"},wp.element.createElement("span",{className:"dashicons dashicons-admin-comments"}),wp.element.createElement("span",{className:"insblock-count insblock-comments-count"},e.comments.count)),null!=e.caption&&wp.element.createElement("li",{className:"insblock-caption"},null!=e.caption&&wp.element.createElement("p",{className:"caption-title"},e.caption.text))))))}))):200!==E?wp.element.createElement("div",null,"Something is wrong: ",v):wp.element.createElement("div",{className:w},"To get Instagram Access Token."," ",wp.element.createElement("a",{target:"_blank",href:"https://outofthesandbox.com/pages/instagram-access-token"},"click here.")),wp.element.createElement(c,null,wp.element.createElement(m,null,wp.element.createElement(u,{title:__("Access Tokens")},wp.element.createElement(b,{label:__("Instagram Access Token"),value:n,help:"To get token link https://outofthesandbox.com/pages/instagram-access-token",onChange:this.onChangeToken})),wp.element.createElement(u,{title:__("Layout Settings")},wp.element.createElement(f,{value:a,onChange:function(e){return d({numberCols:e})},min:1,max:6,step:1,label:__("Columns")}),wp.element.createElement(f,{value:l,onChange:this.onChangeImages,min:1,max:20,step:1,label:__("Number of Images")}),wp.element.createElement(f,{value:r,onChange:function(e){return d({gridGap:e})},min:0,max:20,step:1,label:__("Image spacing (px)")}),wp.element.createElement(g,{label:__("Show profile?"),checked:i,onChange:this.onChangeShowProfile}),wp.element.createElement(g,{label:__("Show equal sized images?"),checked:s,onChange:function(e){return d({hasEqualImages:e})}}))),y)}}]),t}(i);t.a=w}]);